---
import type { FAQ } from '../data/faq';
import { faqs } from '../data/faq';
const { lang = 'en' } = Astro.props as { lang?: string };
const data: FAQ[] = faqs[lang] || faqs.en;
---
<section class="faq" aria-labelledby="faq-heading">
  <div class="container">
    <h2 id="faq-heading" class="section-title">{lang==='en'?'FAQ': lang==='es'?'Preguntas Frecuentes':'Preguntes Freqüents'}</h2>
    <div class="accordion" role="list">
      {data.map((item, i) => (
        <div class="faq-item" role="listitem">
          <button class="faq-trigger" aria-expanded="false" aria-controls={`faq-panel-${i}`} id={`faq-control-${i}`}>
            <span class="faq-cat">{item.category}</span>
            <span class="faq-q">{item.q}</span>
            <span class="chevron" aria-hidden="true">▾</span>
          </button>
          <div id={`faq-panel-${i}`} class="faq-panel" role="region" aria-labelledby={`faq-control-${i}`} hidden>
            <p>{item.a}</p>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
.faq { padding: var(--space-xl) 0 var(--space-2xl); }
.accordion { max-width: 960px; margin: 0 auto; display: grid; gap: .5rem; }
.faq-item { border: 1px solid var(--border); border-radius: 12px; background: var(--background-card); overflow: hidden; }
.faq-trigger { all: unset; cursor: pointer; display: grid; grid-template-columns: auto 1fr auto; gap: .85rem; align-items: center; padding: .95rem 1.2rem; font-size: .9rem; line-height: 1.3; }
.faq-trigger:hover { background: var(--background-elevated); }
.faq-cat { font-size: .65rem; text-transform: uppercase; letter-spacing: .12em; padding: .25rem .5rem; border: 1px solid var(--border); border-radius: 6px; background: rgba(255,255,255,0.02); color: var(--tertiary); }
.faq-q { font-weight: 500; letter-spacing: -.01em; color: var(--primary); }
.chevron { transition: transform .3s; }
.faq-trigger[aria-expanded="true"] .chevron { transform: rotate(180deg); }
.faq-panel { padding: 0 1.2rem 1.1rem 3.1rem; font-size: .85rem; line-height: 1.55; color: var(--secondary); border-top: 1px solid var(--border); animation: fade .3s ease; }
@keyframes fade { from { opacity: 0; transform: translateY(-4px);} to { opacity:1; transform: none; } }
@media (max-width: 600px) { .faq-panel { padding-left: 1.2rem; } }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const triggers = document.querySelectorAll('.faq-trigger');
    triggers.forEach(btn => {
      btn.addEventListener('click', () => {
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        const panel = document.getElementById(btn.getAttribute('aria-controls') || '');
        if (!panel) return;
        if (expanded) {
          btn.setAttribute('aria-expanded', 'false');
          panel.hidden = true;
        } else {
          // optional: close others
          triggers.forEach(o => { if (o !== btn) { o.setAttribute('aria-expanded','false'); const p = document.getElementById(o.getAttribute('aria-controls')||''); if (p) p.hidden = true; }});
          btn.setAttribute('aria-expanded', 'true');
          panel.hidden = false;
        }
      });
    });
  });
</script>
