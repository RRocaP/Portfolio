---
import Icon from './Icon.astro';
import ResearchMetricsViz from './ResearchMetricsViz.astro';
import CitationTimelineChart from './CitationTimelineChart.astro';
import PublicationImpactBubbleChart from './PublicationImpactBubbleChart.astro';
import HIndexProgressionChart from './HIndexProgressionChart.astro';
import ResearchAreaRadarChart from './ResearchAreaRadarChart.astro';
import AdvancedCollaborationNetworkViz from './AdvancedCollaborationNetworkViz.astro';

interface Props {
  lang?: 'en' | 'es' | 'ca';
}

const { lang = 'en' } = Astro.props;

const translations = {
  en: {
    title: 'Comprehensive Research Metrics Dashboard',
    overview: 'Research Overview',
    keyMetrics: 'Key Metrics',
    temporalAnalysis: 'Temporal Analysis',
    impactVisualization: 'Impact Visualization',
    networkAnalysis: 'Network Analysis',
    expertiseMapping: 'Expertise Mapping',
    performanceTracking: 'Performance Tracking',
    researchExcellence: 'Research Excellence',
    viewDetails: 'View Details',
    expandSection: 'Expand Section',
    collapseSection: 'Collapse Section',
    downloadReport: 'Download Report',
    exportData: 'Export Data',
    shareMetrics: 'Share Metrics',
    refreshData: 'Refresh Data',
    lastUpdated: 'Last Updated',
    dataSource: 'Data Source',
    methodology: 'Methodology',
    disclaimer: 'Disclaimer',
    quickStats: 'Quick Stats',
    trends: 'Trends',
    comparisons: 'Comparisons',
    predictions: 'Predictions',
    insights: 'Key Insights',
    recommendations: 'Recommendations',
    nextMilestones: 'Next Milestones',
    overallRating: 'Overall Rating',
    expertLevel: 'Expert Level',
    growthTrajectory: 'Growth Trajectory',
    collaborationIndex: 'Collaboration Index',
    innovationScore: 'Innovation Score',
    leadershipImpact: 'Leadership Impact'
  },
  es: {
    title: 'Panel Integral de Métricas de Investigación',
    overview: 'Resumen de Investigación',
    keyMetrics: 'Métricas Clave',
    temporalAnalysis: 'Análisis Temporal',
    impactVisualization: 'Visualización de Impacto',
    networkAnalysis: 'Análisis de Red',
    expertiseMapping: 'Mapeo de Experiencia',
    performanceTracking: 'Seguimiento de Rendimiento',
    researchExcellence: 'Excelencia en Investigación',
    viewDetails: 'Ver Detalles',
    expandSection: 'Expandir Sección',
    collapseSection: 'Contraer Sección',
    downloadReport: 'Descargar Informe',
    exportData: 'Exportar Datos',
    shareMetrics: 'Compartir Métricas',
    refreshData: 'Actualizar Datos',
    lastUpdated: 'Última Actualización',
    dataSource: 'Fuente de Datos',
    methodology: 'Metodología',
    disclaimer: 'Descargo de Responsabilidad',
    quickStats: 'Estadísticas Rápidas',
    trends: 'Tendencias',
    comparisons: 'Comparaciones',
    predictions: 'Predicciones',
    insights: 'Perspectivas Clave',
    recommendations: 'Recomendaciones',
    nextMilestones: 'Próximos Hitos',
    overallRating: 'Calificación General',
    expertLevel: 'Nivel de Experto',
    growthTrajectory: 'Trayectoria de Crecimiento',
    collaborationIndex: 'Índice de Colaboración',
    innovationScore: 'Puntuación de Innovación',
    leadershipImpact: 'Impacto de Liderazgo'
  },
  ca: {
    title: 'Panell Integral de Mètriques de Recerca',
    overview: 'Resum de Recerca',
    keyMetrics: 'Mètriques Clau',
    temporalAnalysis: 'Anàlisi Temporal',
    impactVisualization: 'Visualització d\'Impacte',
    networkAnalysis: 'Anàlisi de Xarxa',
    expertiseMapping: 'Mapatge d\'Experiència',
    performanceTracking: 'Seguiment de Rendiment',
    researchExcellence: 'Excel·lència en Recerca',
    viewDetails: 'Veure Detalls',
    expandSection: 'Expandir Secció',
    collapseSection: 'Contraure Secció',
    downloadReport: 'Descarregar Informe',
    exportData: 'Exportar Dades',
    shareMetrics: 'Compartir Mètriques',
    refreshData: 'Actualitzar Dades',
    lastUpdated: 'Última Actualització',
    dataSource: 'Font de Dades',
    methodology: 'Metodologia',
    disclaimer: 'Descàrrec de Responsabilitat',
    quickStats: 'Estadístiques Ràpides',
    trends: 'Tendències',
    comparisons: 'Comparacions',
    predictions: 'Prediccions',
    insights: 'Perspectives Clau',
    recommendations: 'Recomanacions',
    nextMilestones: 'Pròxims Fites',
    overallRating: 'Qualificació General',
    expertLevel: 'Nivell d\'Expert',
    growthTrajectory: 'Trajectòria de Creixement',
    collaborationIndex: 'Índex de Col·laboració',
    innovationScore: 'Puntuació d\'Innovació',
    leadershipImpact: 'Impacte de Lideratge'
  }
};

const t = translations[lang];

// Dashboard configuration
const dashboardSections = [
  {
    id: 'overview',
    title: t.keyMetrics,
    icon: 'chart-bar',
    component: 'ResearchMetricsViz',
    priority: 1,
    color: 'blue'
  },
  {
    id: 'timeline',
    title: t.temporalAnalysis,
    icon: 'clock',
    component: 'CitationTimelineChart',
    priority: 2,
    color: 'yellow'
  },
  {
    id: 'impact',
    title: t.impactVisualization,
    icon: 'trending-up',
    component: 'PublicationImpactBubbleChart',
    priority: 3,
    color: 'purple'
  },
  {
    id: 'progression',
    title: t.performanceTracking,
    icon: 'target',
    component: 'HIndexProgressionChart',
    priority: 4,
    color: 'green'
  },
  {
    id: 'expertise',
    title: t.expertiseMapping,
    icon: 'radar',
    component: 'ResearchAreaRadarChart',
    priority: 5,
    color: 'cyan'
  },
  {
    id: 'network',
    title: t.networkAnalysis,
    icon: 'share-2',
    component: 'AdvancedCollaborationNetworkViz',
    priority: 6,
    color: 'orange'
  }
];

// Executive summary metrics
const executiveSummary = {
  overallRating: 94,
  expertLevel: 'Senior Research Scientist',
  growthTrajectory: 'Accelerating',
  collaborationIndex: 87,
  innovationScore: 91,
  leadershipImpact: 88
};

// Key insights
const keyInsights = [
  {
    category: 'Performance',
    insight: 'Above-average h-index growth trajectory indicating strong research impact',
    trend: 'positive',
    confidence: 95
  },
  {
    category: 'Collaboration',
    insight: 'Strong international network with balanced institutional partnerships',
    trend: 'positive',
    confidence: 88
  },
  {
    category: 'Innovation',
    insight: 'High-impact publications in top-tier journals demonstrate research excellence',
    trend: 'positive',
    confidence: 92
  },
  {
    category: 'Growth',
    insight: 'Consistent publication output with increasing citation velocity',
    trend: 'positive',
    confidence: 90
  }
];

// Next milestones
const nextMilestones = [
  {
    milestone: 'h-Index 15',
    target: '2025',
    probability: 90,
    description: 'Continue current research trajectory'
  },
  {
    milestone: '300 Citations',
    target: '2025',
    probability: 85,
    description: 'Based on current citation velocity'
  },
  {
    milestone: 'Senior Research Position',
    target: '2026',
    probability: 75,
    description: 'Leverage growing research impact'
  }
];
---

<div class="comprehensive-metrics-dashboard" role="region" aria-labelledby="dashboard-heading">
  <!-- Dashboard Header -->
  <div class="dashboard-header mb-12">
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 id="dashboard-heading" class="text-display-lg mb-4 text-white">{t.title}</h1>
        <p class="text-body text-gray-400 max-w-3xl">
          Comprehensive analysis of research performance, collaboration networks, and academic impact metrics across multiple dimensions.
        </p>
      </div>
      
      <!-- Dashboard Controls -->
      <div class="flex items-center gap-3">
        <button id="refresh-data" class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors">
          <Icon name="refresh" size="sm" />
          <span class="text-caption">{t.refreshData}</span>
        </button>
        <button id="export-data" class="flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
          <Icon name="download" size="sm" />
          <span class="text-caption">{t.exportData}</span>
        </button>
        <button id="share-metrics" class="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors">
          <Icon name="share" size="sm" />
          <span class="text-caption">{t.shareMetrics}</span>
        </button>
      </div>
    </div>

    <!-- Executive Summary -->
    <div class="executive-summary p-8 bg-gradient-to-r from-blue-600/10 via-purple-600/10 to-green-600/10 border border-gray-800 rounded-2xl mb-8">
      <h2 class="text-heading-lg text-white mb-6">{t.researchExcellence}</h2>
      
      <div class="grid grid-cols-2 lg:grid-cols-6 gap-6">
        <div class="text-center">
          <div class="text-display-sm font-bold text-white mb-2">{executiveSummary.overallRating}/100</div>
          <div class="text-caption text-blue-400">{t.overallRating}</div>
        </div>
        
        <div class="text-center">
          <div class="text-body-sm font-bold text-white mb-2">{executiveSummary.expertLevel}</div>
          <div class="text-caption text-purple-400">{t.expertLevel}</div>
        </div>
        
        <div class="text-center">
          <div class="text-body-sm font-bold text-white mb-2">{executiveSummary.growthTrajectory}</div>
          <div class="text-caption text-green-400">{t.growthTrajectory}</div>
        </div>
        
        <div class="text-center">
          <div class="text-display-sm font-bold text-white mb-2">{executiveSummary.collaborationIndex}</div>
          <div class="text-caption text-yellow-400">{t.collaborationIndex}</div>
        </div>
        
        <div class="text-center">
          <div class="text-display-sm font-bold text-white mb-2">{executiveSummary.innovationScore}</div>
          <div class="text-caption text-cyan-400">{t.innovationScore}</div>
        </div>
        
        <div class="text-center">
          <div class="text-display-sm font-bold text-white mb-2">{executiveSummary.leadershipImpact}</div>
          <div class="text-caption text-red-400">{t.leadershipImpact}</div>
        </div>
      </div>
    </div>

    <!-- Quick Navigation -->
    <div class="dashboard-nav flex flex-wrap gap-2 mb-8">
      {dashboardSections.map((section, index) => (
        <button 
          class={`nav-button flex items-center gap-2 px-4 py-2 border border-gray-700 rounded-lg transition-all duration-300 hover:border-${section.color}-500 hover:bg-${section.color}-600/10`}
          data-section={section.id}
          style={`animation-delay: ${index * 0.1}s`}
        >
          <Icon name={section.icon} size="sm" class={`text-${section.color}-400`} />
          <span class="text-caption text-gray-300">{section.title}</span>
        </button>
      ))}
    </div>
  </div>

  <!-- Dashboard Sections -->
  <div class="dashboard-content space-y-16">
    <!-- Section 1: Key Metrics Overview -->
    <section id="section-overview" class="dashboard-section" data-section="overview">
      <div class="section-header flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <Icon name="chart-bar" size="lg" class="text-blue-400" />
          <h2 class="text-heading-lg text-white">{t.keyMetrics}</h2>
        </div>
        <button class="section-toggle text-gray-400 hover:text-white transition-colors" data-target="overview">
          <Icon name="chevron-down" size="sm" />
        </button>
      </div>
      <div class="section-content">
        <ResearchMetricsViz lang={lang} />
      </div>
    </section>

    <!-- Section 2: Citation Timeline -->
    <section id="section-timeline" class="dashboard-section" data-section="timeline">
      <div class="section-header flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <Icon name="clock" size="lg" class="text-yellow-400" />
          <h2 class="text-heading-lg text-white">{t.temporalAnalysis}</h2>
        </div>
        <button class="section-toggle text-gray-400 hover:text-white transition-colors" data-target="timeline">
          <Icon name="chevron-down" size="sm" />
        </button>
      </div>
      <div class="section-content">
        <CitationTimelineChart lang={lang} />
      </div>
    </section>

    <!-- Section 3: Publication Impact -->
    <section id="section-impact" class="dashboard-section" data-section="impact">
      <div class="section-header flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <Icon name="trending-up" size="lg" class="text-purple-400" />
          <h2 class="text-heading-lg text-white">{t.impactVisualization}</h2>
        </div>
        <button class="section-toggle text-gray-400 hover:text-white transition-colors" data-target="impact">
          <Icon name="chevron-down" size="sm" />
        </button>
      </div>
      <div class="section-content">
        <PublicationImpactBubbleChart lang={lang} />
      </div>
    </section>

    <!-- Section 4: H-Index Progression -->
    <section id="section-progression" class="dashboard-section" data-section="progression">
      <div class="section-header flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <Icon name="target" size="lg" class="text-green-400" />
          <h2 class="text-heading-lg text-white">{t.performanceTracking}</h2>
        </div>
        <button class="section-toggle text-gray-400 hover:text-white transition-colors" data-target="progression">
          <Icon name="chevron-down" size="sm" />
        </button>
      </div>
      <div class="section-content">
        <HIndexProgressionChart lang={lang} />
      </div>
    </section>

    <!-- Section 5: Research Expertise -->
    <section id="section-expertise" class="dashboard-section" data-section="expertise">
      <div class="section-header flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <Icon name="radar" size="lg" class="text-cyan-400" />
          <h2 class="text-heading-lg text-white">{t.expertiseMapping}</h2>
        </div>
        <button class="section-toggle text-gray-400 hover:text-white transition-colors" data-target="expertise">
          <Icon name="chevron-down" size="sm" />
        </button>
      </div>
      <div class="section-content">
        <ResearchAreaRadarChart lang={lang} />
      </div>
    </section>

    <!-- Section 6: Collaboration Network -->
    <section id="section-network" class="dashboard-section" data-section="network">
      <div class="section-header flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <Icon name="share-2" size="lg" class="text-orange-400" />
          <h2 class="text-heading-lg text-white">{t.networkAnalysis}</h2>
        </div>
        <button class="section-toggle text-gray-400 hover:text-white transition-colors" data-target="network">
          <Icon name="chevron-down" size="sm" />
        </button>
      </div>
      <div class="section-content">
        <AdvancedCollaborationNetworkViz lang={lang} />
      </div>
    </section>
  </div>

  <!-- Insights and Recommendations Sidebar -->
  <div class="dashboard-sidebar lg:fixed lg:right-8 lg:top-32 lg:w-80 lg:max-h-[calc(100vh-8rem)] lg:overflow-y-auto mt-16 lg:mt-0">
    <!-- Key Insights -->
    <div class="insights-panel p-6 bg-surface border border-gray-800 rounded-2xl mb-6">
      <div class="flex items-center gap-3 mb-6">
        <Icon name="lightbulb" size="lg" class="text-yellow-400" />
        <h3 class="text-heading-md text-white">{t.insights}</h3>
      </div>
      
      <div class="space-y-4">
        {keyInsights.map((insight, index) => (
          <div 
            class="p-4 bg-gray-800/30 border border-gray-700 rounded-xl"
            style={`animation-delay: ${index * 0.2}s`}
          >
            <div class="flex items-center gap-2 mb-2">
              <span class="text-body-sm font-medium text-white">{insight.category}</span>
              <div class={`w-2 h-2 rounded-full ${
                insight.trend === 'positive' ? 'bg-green-400' : 'bg-yellow-400'
              }`}></div>
              <span class="text-caption text-gray-400">{insight.confidence}%</span>
            </div>
            <p class="text-body-sm text-gray-300">{insight.insight}</p>
          </div>
        ))}
      </div>
    </div>

    <!-- Next Milestones -->
    <div class="milestones-panel p-6 bg-surface border border-gray-800 rounded-2xl">
      <div class="flex items-center gap-3 mb-6">
        <Icon name="flag" size="lg" class="text-green-400" />
        <h3 class="text-heading-md text-white">{t.nextMilestones}</h3>
      </div>
      
      <div class="space-y-4">
        {nextMilestones.map((milestone, index) => (
          <div 
            class="p-4 bg-green-600/5 border border-green-600/20 rounded-xl"
            style={`animation-delay: ${index * 0.15}s`}
          >
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-body-sm font-medium text-white">{milestone.milestone}</h4>
              <span class="text-caption text-green-400 font-medium">{milestone.probability}%</span>
            </div>
            <div class="text-caption text-gray-400 mb-2">Target: {milestone.target}</div>
            <p class="text-caption text-gray-300">{milestone.description}</p>
          </div>
        ))}
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="dashboard-footer mt-16 pt-8 border-t border-gray-800 text-center">
    <div class="flex items-center justify-center gap-8 text-caption text-gray-500 mb-4">
      <span>{t.lastUpdated}: December 2024</span>
      <span>{t.dataSource}: ORCID, Google Scholar, Internal Analytics</span>
    </div>
    <div class="text-caption text-gray-600">
      Generated using advanced analytics and visualization techniques. Metrics are computed using standardized academic assessment methodologies.
    </div>
  </footer>
</div>

<style>
  .comprehensive-metrics-dashboard {
    animation: fadeInUp 0.8s ease-out;
    position: relative;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(40px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Dashboard Header */
  .dashboard-header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: rgba(10, 10, 10, 0.95);
    backdrop-filter: blur(20px);
    padding: 1rem 0;
    margin-bottom: 3rem;
    border-bottom: 1px solid rgba(55, 65, 81, 0.3);
  }
  
  .executive-summary {
    background: 
      linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 50%, rgba(16, 185, 129, 0.1) 100%),
      rgba(23, 23, 23, 0.8);
    backdrop-filter: blur(10px);
  }
  
  /* Dashboard Navigation */
  .dashboard-nav {
    animation: slideInDown 0.6s ease-out 0.2s both;
  }
  
  .nav-button {
    animation: fadeInUp 0.6s ease-out both;
  }
  
  .nav-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  
  .nav-button.active {
    border-color: currentColor;
    background: rgba(59, 130, 246, 0.1);
  }
  
  @keyframes slideInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Dashboard Sections */
  .dashboard-section {
    opacity: 0;
    transform: translateY(40px);
    animation: fadeInSection 0.8s ease-out forwards;
  }
  
  .dashboard-section:nth-child(1) { animation-delay: 0.1s; }
  .dashboard-section:nth-child(2) { animation-delay: 0.2s; }
  .dashboard-section:nth-child(3) { animation-delay: 0.3s; }
  .dashboard-section:nth-child(4) { animation-delay: 0.4s; }
  .dashboard-section:nth-child(5) { animation-delay: 0.5s; }
  .dashboard-section:nth-child(6) { animation-delay: 0.6s; }
  
  @keyframes fadeInSection {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .section-header {
    border-bottom: 1px solid rgba(55, 65, 81, 0.3);
    padding-bottom: 1rem;
  }
  
  .section-toggle {
    transition: transform 0.3s ease;
  }
  
  .section-toggle.expanded {
    transform: rotate(180deg);
  }
  
  .section-content {
    max-height: none;
    overflow: visible;
    transition: all 0.5s ease-in-out;
  }
  
  .section-content.collapsed {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
  }
  
  /* Sidebar */
  .dashboard-sidebar {
    animation: slideInRight 0.8s ease-out 0.4s both;
  }
  
  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(40px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  
  .insights-panel,
  .milestones-panel {
    backdrop-filter: blur(10px);
  }
  
  .insights-panel > div > div,
  .milestones-panel > div > div {
    animation: fadeInUp 0.6s ease-out both;
  }
  
  /* Interactive Elements */
  .dashboard-section:hover .section-header {
    border-bottom-color: rgba(59, 130, 246, 0.5);
  }
  
  /* Responsive Design */
  @media (max-width: 1024px) {
    .dashboard-header {
      position: relative;
    }
    
    .dashboard-sidebar {
      position: relative;
      width: 100%;
      max-height: none;
    }
    
    .dashboard-content {
      margin-right: 0;
    }
  }
  
  @media (max-width: 768px) {
    .dashboard-header .flex {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
    
    .dashboard-nav {
      flex-direction: column;
      align-items: stretch;
    }
    
    .executive-summary .grid {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .nav-button {
      justify-content: center;
    }
  }
  
  /* Dark theme enhancements */
  .dashboard-section {
    background: linear-gradient(135deg, rgba(17, 24, 39, 0.8) 0%, rgba(31, 41, 55, 0.6) 100%);
    border: 1px solid rgba(55, 65, 81, 0.3);
    border-radius: 1rem;
    padding: 2rem;
    backdrop-filter: blur(10px);
  }
  
  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .comprehensive-metrics-dashboard,
    .comprehensive-metrics-dashboard * {
      animation: none !important;
      transition: none !important;
    }
  }
  
  @media (prefers-contrast: high) {
    .dashboard-section,
    .insights-panel,
    .milestones-panel {
      border-width: 2px;
      border-color: #6B7280;
    }
    
    .executive-summary {
      background: rgba(31, 41, 55, 0.9);
    }
  }
  
  /* Print styles */
  @media print {
    .dashboard-header,
    .dashboard-sidebar {
      display: none;
    }
    
    .dashboard-section {
      break-inside: avoid;
      page-break-inside: avoid;
    }
  }
</style>

<script>
  // Dashboard interactivity
  function initDashboard() {
    // Section navigation
    const navButtons = document.querySelectorAll('.nav-button');
    const sections = document.querySelectorAll('.dashboard-section');
    
    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        const targetSection = button.dataset.section;
        const targetElement = document.getElementById(`section-${targetSection}`);
        
        if (targetElement) {
          targetElement.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start',
            inline: 'nearest'
          });
          
          // Update active state
          navButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
        }
      });
    });
    
    // Section toggles
    const sectionToggles = document.querySelectorAll('.section-toggle');
    
    sectionToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const targetId = toggle.dataset.target;
        const content = document.querySelector(`#section-${targetId} .section-content`);
        
        if (content) {
          content.classList.toggle('collapsed');
          toggle.classList.toggle('expanded');
          
          // Update button text/icon if needed
          const isExpanded = toggle.classList.contains('expanded');
          const icon = toggle.querySelector('svg');
          if (icon) {
            icon.style.transform = isExpanded ? 'rotate(180deg)' : 'rotate(0deg)';
          }
        }
      });
    });
    
    // Dashboard controls
    const refreshButton = document.getElementById('refresh-data');
    const exportButton = document.getElementById('export-data');
    const shareButton = document.getElementById('share-metrics');
    
    refreshButton?.addEventListener('click', () => {
      // Add loading state
      refreshButton.disabled = true;
      refreshButton.innerHTML = '<span class="animate-spin">⟳</span> Refreshing...';
      
      // Simulate data refresh
      setTimeout(() => {
        refreshButton.disabled = false;
        refreshButton.innerHTML = '<i class="icon-refresh"></i> Refresh Data';
        
        // Show success message
        showNotification('Data refreshed successfully', 'success');
      }, 2000);
    });
    
    exportButton?.addEventListener('click', () => {
      // Generate and download report
      generateReport();
      showNotification('Report exported successfully', 'success');
    });
    
    shareButton?.addEventListener('click', () => {
      // Share metrics
      if (navigator.share) {
        navigator.share({
          title: 'Research Metrics Dashboard',
          text: 'Check out my comprehensive research metrics dashboard',
          url: window.location.href
        });
      } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(window.location.href);
        showNotification('Link copied to clipboard', 'info');
      }
    });
    
    // Scroll spy for navigation
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '-50px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.dataset.section;
          const navButton = document.querySelector(`[data-section="${sectionId}"]`);
          
          // Update active navigation
          navButtons.forEach(btn => btn.classList.remove('active'));
          navButton?.classList.add('active');
        }
      });
    }, observerOptions);
    
    sections.forEach(section => {
      observer.observe(section);
    });
  }
  
  // Utility functions
  function showNotification(message: string, type: 'success' | 'error' | 'info' = 'info') {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg text-white max-w-sm transition-all duration-300 ${
      type === 'success' ? 'bg-green-600' :
      type === 'error' ? 'bg-red-600' : 'bg-blue-600'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Animate in
    requestAnimationFrame(() => {
      notification.style.transform = 'translateX(0)';
      notification.style.opacity = '1';
    });
    
    // Remove after 3 seconds
    setTimeout(() => {
      notification.style.transform = 'translateX(100%)';
      notification.style.opacity = '0';
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 300);
    }, 3000);
  }
  
  function generateReport() {
    // Create downloadable report
    const reportData = {
      timestamp: new Date().toISOString(),
      metrics: {
        publications: 16,
        citations: 250,
        hIndex: 12,
        collaborations: 25
      },
      analysis: 'Comprehensive research metrics analysis...'
    };
    
    const blob = new Blob([JSON.stringify(reportData, null, 2)], {
      type: 'application/json'
    });
    
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `research-metrics-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
  
  // Initialize dashboard
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDashboard);
  } else {
    initDashboard();
  }
  
  // Handle window resize for responsive behavior
  let resizeTimeout: NodeJS.Timeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      // Trigger any necessary recalculations
      console.log('Dashboard resized');
    }, 250);
  });
</script>