---
import { timelineData } from '../data/i18n';
const { lang='en' } = Astro.props as { lang?: string };
const items = timelineData[lang] || [];
---
<div class="timeline-roadmap" aria-label="Career timeline">
  <svg class="timeline-path" viewBox="0 0 1200 600" preserveAspectRatio="none" aria-hidden="true">
    <path d="M 100,500 Q 300,400 400,300 T 600,200 Q 800,150 1000,100"
          stroke="url(#gradient)" stroke-width="3" fill="none" stroke-dasharray="8,4" opacity="0.3" />
    <defs>
      <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" style="stop-color:#DA291C;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#FFD93D;stop-opacity:1" />
      </linearGradient>
    </defs>
  </svg>
  <div class="timeline-content">
    {items.map((t, i) => (
      <div class={`timeline-item animate-fade-in-up ${i===items.length-1 ? 'current' : ''}`} style={`--index:${i+1}`}>
        <div class="timeline-dot" />
        <div class={`timeline-card ${i===items.length-1 ? 'highlight' : ''}`}> 
          <span class="timeline-year">{t.year}</span>
          <h3>{t.title}</h3>
          <p>{t.line}</p>
          <small>{t.detail}</small>
        </div>
      </div>
    ))}
    <div class="profile-end animate-fade-in-up animate-delay-4">
      <picture>
        <source 
          srcset="/Portfolio/profile.avif 120w, /Portfolio/profile@2x.avif 240w" 
          type="image/avif" 
          sizes="120px"
        />
        <source 
          srcset="/Portfolio/profile.webp 120w, /Portfolio/profile@2x.webp 240w" 
          type="image/webp"
          sizes="120px" 
        />
        <img 
          src="/Portfolio/profile.jpg" 
          srcset="/Portfolio/profile.jpg 120w, /Portfolio/profile@2x.jpg 240w"
          alt="Profile portrait" 
          loading="lazy" 
          decoding="async" 
          width="120" 
          height="120"
          sizes="120px"
        />
      </picture>
      <div class="profile-info">
        <h3>Ramon Roca Pinilla</h3>
        <p>Computational â†’ Experimental loop</p>
      </div>
    </div>
  </div>
</div>
<style>
.timeline-roadmap { position: relative; margin: var(--space-lg) 0; min-height: 600px; }
.timeline-path { position:absolute; width:100%; height:100%; inset:0; }
.timeline-content { position:relative; display:grid; grid-template-columns:repeat(5,1fr); gap:var(--space-md); padding: var(--space-lg) 0; }
.timeline-item { position:relative; animation-delay: calc(var(--index) * 0.08s); }
.timeline-dot { width:16px; height:16px; background:var(--accent-red); border:3px solid var(--background); border-radius:50%; position:absolute; top:-8px; left:50%; transform:translateX(-50%); z-index:2; box-shadow:0 0 0 8px rgba(218,41,28,0.12); }
.timeline-card { background: var(--background-card); border:1px solid var(--border); border-radius:12px; padding: var(--space-md); margin-top: var(--space-md); transition: all .3s; backdrop-filter: blur(10px); }
.timeline-card:hover { transform: translateY(-6px); box-shadow: 0 10px 36px rgba(218,41,28,0.15); border-color: var(--accent-red); }
.timeline-card.highlight { background: linear-gradient(135deg, rgba(218,41,28,0.06) 0%, rgba(255,217,61,0.06) 100%); border-color: var(--accent-red); }
.timeline-year { display:inline-block; font-size:.75rem; color: var(--accent-red); margin-bottom: .35rem; font-weight:600; letter-spacing:.02em; }
.profile-end { grid-column:5; display:flex; flex-direction:column; align-items:center; margin-top: var(--space-lg); }
.profile-end img { width:120px; height:120px; border-radius:50%; object-fit:cover; border:4px solid var(--background); box-shadow:0 0 0 1px var(--border),0 8px 24px rgba(0,0,0,0.15); margin-bottom: var(--space-sm); }
.profile-info { text-align:center; }
.profile-info h3 { font-size:1.1rem; margin:0 0 .25rem; }
.profile-info p { font-size:.85rem; color: var(--secondary); margin:0; }
@media (max-width: 900px){
  .timeline-content { grid-template-columns:1fr; }
  .timeline-path { display:none; }
  .timeline-item { margin-left: var(--space-md); border-left:2px solid var(--border); padding-left: var(--space-md); }
  .timeline-dot { left:-9px; transform:none; }
  .profile-end { grid-column:1; }
}
</style>
