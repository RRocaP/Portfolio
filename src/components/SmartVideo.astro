---
// SmartVideo.astro - Accessible, responsive video component with reduced motion support
export interface Props {
  mp4Src: string;
  webmSrc?: string;
  poster: string;
  aspect?: '16/9' | '21/9' | '1/1' | '9/16';
  autoplay?: boolean;
  className?: string;
  alt?: string;
  priority?: boolean;
}

const { 
  mp4Src, 
  webmSrc, 
  poster, 
  aspect = '16/9', 
  autoplay = true, 
  className = '',
  alt = '',
  priority = false
} = Astro.props;

const aspectClasses = {
  '16/9': 'aspect-video',
  '21/9': 'aspect-[21/9]',
  '1/1': 'aspect-square',
  '9/16': 'aspect-[9/16]'
};
---

<div class={`relative w-full overflow-hidden rounded-2xl shadow-lg ${aspectClasses[aspect]} ${className}`}>
  <video
    class="h-full w-full object-cover"
    playsinline
    muted
    loop
    preload={priority ? 'auto' : 'metadata'}
    {...(autoplay ? { autoplay: true } : {})}
    poster={poster}
    aria-label={alt}
  >
    {webmSrc && <source src={webmSrc} type="video/webm" />}
    <source src={mp4Src} type="video/mp4" />
    Your browser does not support the video tag.
  </video>
  
  <!-- Fallback for no-JS and reduced motion -->
  <noscript>
    <img src={poster} alt={alt} class="h-full w-full object-cover" />
  </noscript>
  
  <!-- Reduced motion fallback -->
  <img 
    src={poster} 
    alt={alt}
    class="h-full w-full object-cover reduced-motion-fallback hidden"
  />
</div>

<style>
  @media (prefers-reduced-motion: reduce) {
    video[autoplay] {
      display: none !important;
    }
    .reduced-motion-fallback {
      display: block !important;
    }
  }
  
  /* Enhanced focus states for accessibility */
  video:focus-visible {
    outline: 2px solid var(--accent-red);
    outline-offset: 2px;
  }
</style>
