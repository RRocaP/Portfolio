---
export interface Props {
  title: string;
  description?: string;
  lang?: string;
  canonicalUrl?: string;
}

const { 
  title,
  description = "Ramon Roca Pinilla - Biomedical engineer and molecular biologist developing next-generation antimicrobial therapies through AI-driven protein engineering",
  lang = "en",
  canonicalUrl = Astro.url.href
} = Astro.props;

// Generate hreflang alternatives
const baseUrl = "https://rrocap.github.io/Portfolio";
const hreflangs = [
  { lang: "en", url: `${baseUrl}/en/` },
  { lang: "es", url: `${baseUrl}/es/` },
  { lang: "ca", url: `${baseUrl}/ca/` }
];
---

<!DOCTYPE html>
<html lang={lang} dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="theme-color" content="#DA291C" />
    <meta name="color-scheme" content="dark light" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';" />
    
    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/svg+xml" href="/Portfolio/favicon.svg" />
    <link rel="apple-touch-icon" href="/Portfolio/favicon.svg" />
    <link rel="manifest" href="/Portfolio/manifest.json" />
    
    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalUrl} />
    
    <!-- Hreflang tags for multilingual SEO -->
    {hreflangs.map(({ lang: hrefLang, url }) => (
      <link rel="alternate" hreflang={hrefLang} href={url} />
    ))}
    <link rel="alternate" hreflang="x-default" href={`${baseUrl}/en/`} />
    
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    
    <!-- Enhanced Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Ramon Roca Pinilla",
      "jobTitle": "Biomedical Engineer & Molecular Biologist",
      "description": "Biomedical engineer and molecular biologist developing next-generation antimicrobial therapies through AI-driven protein engineering",
      "url": "https://rrocap.github.io/Portfolio/",
      "image": "https://rrocap.github.io/Portfolio/profile.jpg",
      "email": "ramon.rocap@gmail.com",
      "sameAs": [
        "https://www.linkedin.com/in/ramonrocapinilla/",
        "https://github.com/RRocaP",
        "https://orcid.org/0000-0002-7393-6200",
        "https://scholar.google.com/citations?hl=fr&user=jYIZGT0AAAAJ"
      ],
      "affiliation": {
        "@type": "Organization",
        "name": "Children's Medical Research Institute",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Sydney",
          "addressRegion": "NSW",
          "addressCountry": "Australia"
        }
      },
      "alumniOf": [
        {
          "@type": "EducationalOrganization",
          "name": "Universitat Aut√≤noma de Barcelona",
          "alternateName": "UAB"
        },
        {
          "@type": "EducationalOrganization", 
          "name": "University of California, Irvine",
          "alternateName": "UC Irvine"
        }
      ],
      "knowsAbout": [
        "Biomedical Engineering",
        "Molecular Biology", 
        "Protein Engineering",
        "Antimicrobial Development",
        "AI-driven Drug Discovery",
        "Vector Systems",
        "Biotechnology",
        "Computational Biology"
      ],
      "hasOccupation": {
        "@type": "Occupation",
        "name": "Postdoctoral Researcher",
        "occupationLocation": {
          "@type": "Place",
          "name": "Sydney, Australia"
        },
        "skills": [
          "Protein Engineering",
          "Molecular Biology",
          "Biomedical Engineering",
          "AI Drug Discovery"
        ]
      }
    }
    </script>
    
    <!-- Enhanced Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="https://rrocap.github.io/Portfolio/profile.jpg" />
    <meta property="og:image:alt" content="Ramon Roca Pinilla - Professional headshot" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Ramon Roca Pinilla Portfolio" />
    <meta property="og:locale" content={lang === 'en' ? 'en_US' : lang === 'es' ? 'es_ES' : 'ca_ES'} />
    
    <!-- Enhanced Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalUrl} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://rrocap.github.io/Portfolio/profile.jpg" />
    <meta name="twitter:image:alt" content="Ramon Roca Pinilla - Professional headshot" />
    <meta name="twitter:creator" content="@RamonRocaP" />
    
    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    
    <!-- Critical font loading with font-display: swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    
    <!-- Service Worker Registration -->
    <script>
      // Register service worker for PWA capabilities
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/Portfolio/sw.js')
            .then(registration => {
              console.log('Service Worker registered successfully:', registration.scope);
              
              // Handle updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                      // New content available, prompt user to refresh
                      if (confirm('New content available! Click OK to refresh.')) {
                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload();
                      }
                    }
                  });
                }
              });
            })
            .catch(error => {
              console.log('Service Worker registration failed:', error);
            });
        });
      }
    </script>
    
    <!-- Skip to main content link for accessibility -->
    <style>
      .skip-link {
        position: absolute;
        top: -40px;
        left: 6px;
        background: var(--accent-red);
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        border-radius: 4px;
        font-weight: 500;
        z-index: 9999;
        transition: top 0.3s;
      }
      .skip-link:focus {
        top: 6px;
      }
    </style>
  </head>
  <body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <main id="main-content" role="main">
      <slot />
    </main>
  </body>
</html>

<style is:global>
  :root {
    /* Sophisticated Black & Red Theme */
    --catalan-red: #DA291C;
    --catalan-yellow: #FFD93D;
    
    /* Dark Theme Base Colors */
    --primary: #ffffff; /* White text on dark background */
    --secondary: #e0e0e0; /* Light gray text */
    --tertiary: #b0b0b0; /* Medium light gray */
    --accent-red: #DA291C; /* Vibrant red accent */
    --accent-red-hover: #FF3D3D; /* Brighter red for hover */
    --accent-red-bg: rgba(218, 41, 28, 0.1); /* Red background tint */
    
    /* Dark Backgrounds */
    --background: #0a0a0a; /* Deep black background */
    --background-alt: #1a1a1a; /* Slightly lighter black */
    --background-card: #1e1e1e; /* Card backgrounds */
    --background-elevated: #252525; /* Elevated surfaces */
    
    /* Borders */
    --border: #333333; /* Dark borders */
    --border-light: #404040; /* Lighter borders */
    --border-red: rgba(218, 41, 28, 0.3); /* Red-tinted borders */
    
    /* Supporting colors for dark theme */
    --text-primary: #ffffff;
    --text-secondary: #e0e0e0;
    --text-light: #b0b0b0;
    --text-muted: #888888;
    
    /* Gradients */
    --gradient-red: linear-gradient(135deg, #DA291C 0%, #FF3D3D 100%);
    --gradient-dark: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
    
    /* Typography - Stylish Font Stack */
    --font-primary: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-display: 'Playfair Display', Georgia, serif;
    --font-mono: 'SF Mono', Monaco, 'Cascadia Code', monospace;
    
    --font-weight-extralight: 200;
    --font-weight-light: 300;
    --font-weight-regular: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;
    --font-weight-black: 900;
    
    /* Spacing */
    --space-xs: 0.5rem;
    --space-sm: 1rem;
    --space-md: 2rem;
    --space-lg: 4rem;
    --space-xl: 8rem;
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--background-alt);
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--tertiary);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: var(--font-primary);
    font-weight: var(--font-weight-regular); /* Default body text to regular */
    line-height: 1.7; /* Increased line height for readability */
    color: var(--primary);
    background-color: var(--background);
    font-size: 17px; /* Slightly larger base font size */
    letter-spacing: -0.01em;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display);
    font-weight: var(--font-weight-bold);
    line-height: 1.1;
    margin-bottom: 1.5rem;
    letter-spacing: -0.025em;
    color: var(--primary);
  }

  h1 {
    font-size: clamp(2.5rem, 5vw, 4rem);
  }

  h2 {
    font-size: clamp(2rem, 4vw, 3rem);
  }

  h3 {
    font-size: clamp(1.5rem, 3vw, 2rem);
  }

  p {
    margin-bottom: 1.5rem; /* Increased paragraph spacing */
    line-height: 1.8; /* Increased line height for readability */
  }

  a {
    color: var(--primary);
    text-decoration: none;
    transition: all 0.2s ease-in-out; /* Smoother transitions */
    border-bottom: 1px solid transparent;
  }

  a:hover {
    color: var(--accent-red-hover); /* Enhanced hover color */
    border-color: var(--accent-red-hover); /* Stronger underline on hover */
    opacity: 1; /* Ensure full opacity */
    transform: translateY(-1px); /* Subtle lift effect */
  }

  .container {
    max-width: 1280px; /* Slightly wider container */
    margin: 0 auto;
    padding: 0 25px; /* Increased padding */
  }

  .section {
    padding: var(--space-xl) 0;
    position: relative; /* For potential background effects */
  }

  .accent-bar {
    width: 80px; /* Wider accent bar */
    height: 4px; /* Thicker accent bar */
    background: linear-gradient(90deg, var(--accent-red) 0%, var(--accent-yellow) 100%);
    margin: 1rem auto 2rem; /* Centered and more spacing */
    border-radius: 2px;
    opacity: 0.8;
  }

  @media (max-width: 768px) {
    .section {
      padding: var(--space-lg) 0;
    }
    .accent-bar {
      width: 60px;
      height: 3px;
      margin: 0.8rem auto 1.5rem;
    }
  }

  /* Dark Mode */
  @media (prefers-color-scheme: dark) {
    :root {
      --primary: #e0e0e0; /* Lighter text for dark mode */
      --secondary: #b0b0b0;
      --tertiary: #777777;
      --background: #0a0a0a; /* Deeper dark background */
      --background-alt: #1a1a1a; /* Slightly lighter alt background */
      --border: #2a2a2a;
      --accent-red: #FF6B6B; /* Brighter red for dark mode */
      --accent-yellow: #FFD700; /* Consistent yellow */
    }
    
    body {
      background: var(--background);
      color: var(--primary);
    }
    
    .navigation {
      background: rgba(10, 10, 10, 0.95); /* Match new dark background */
      box-shadow: 0 1px 0 rgba(255,255,255,.05);
    }
    
    .timeline-card, .publication-card, .research-card, .contact-card, .protein-viewer-container {
      background: var(--background-alt);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4); /* Stronger shadow for depth */
    }
    
    .footer {
      background: var(--background-alt);
      border-top-color: var(--border);
    }
    
    .social-links a {
      background: var(--background-alt);
      border-color: var(--border);
    }
    
    .social-links a:hover {
      background: rgba(255, 107, 107, 0.1); /* Lighter hover for dark mode red */
    }
    
    a {
      color: var(--primary); /* Default link color */
    }
    
    a:hover {
      color: var(--accent-red); /* Accent color on hover */
    }
    
    .btn-primary {
      background: var(--accent-red);
      border-color: var(--accent-red);
      color: var(--background); /* Text color for primary button */
    }
    
    .btn-primary:hover {
      background: transparent;
      color: var(--accent-red);
    }
  }
</style>