---
import Layout from '../../layouts/Layout.astro';
import HeroInteractive from '../../components/ml/HeroInteractive.astro';
import AboutSection from '../../components/ml/AboutSection.astro';
import ResearchIdentity from '../../components/ml/ResearchIdentity.astro';
import ImpactDashboard from '../../components/ml/ImpactDashboard.astro';
import PublicationList from '../../components/ml/PublicationList.astro';
import CareerTimeline from '../../components/ml/CareerTimeline.astro';
import TerminalContact from '../../components/ml/TerminalContact.astro';
import Footer from '../../components/Footer.astro';
---

<Layout
  title="Ramon Roca Pinilla - Biomedical Engineer"
  description="Biomedical engineer specializing in antimicrobial proteins, AAV vectors, and functional inclusion bodies."
  lang="en"
  theme="ml-native"
>
  <main>
    <HeroInteractive lang="en" />
    <AboutSection lang="en" />
    <ResearchIdentity lang="en" />
    <ImpactDashboard lang="en" />
    <PublicationList lang="en" />
    <CareerTimeline lang="en" />
    <TerminalContact lang="en" />
  </main>

  <Footer />
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>

<script>
  function initAnimations() {
    const els = document.querySelectorAll('[data-animate]');
    if (!els.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const el = entry.target as HTMLElement;
            const delay = parseInt(el.dataset.delay || '0', 10);
            setTimeout(() => {
              el.classList.add('is-visible');
            }, delay);
            observer.unobserve(el);
          }
        });
      },
      { threshold: 0.15 }
    );

    els.forEach((el) => observer.observe(el));
  }

  // Run on initial load and Astro page transitions
  document.addEventListener('DOMContentLoaded', initAnimations);
  document.addEventListener('astro:page-load', initAnimations);
  if (document.readyState !== 'loading') initAnimations();
</script>

<style is:global>
  [data-animate] {
    opacity: 0;
    transform: translateY(32px);
    transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1), transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
  }

  [data-animate].is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    [data-animate] {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }

  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .section {
    position: relative;
  }
</style>
