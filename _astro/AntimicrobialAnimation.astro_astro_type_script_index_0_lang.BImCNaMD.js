class t{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.width=0,this.height=0,this.bacteria=[],this.peptides=[],this.particles=[],this.frame=0,this.init(),this.animate()}init(){this.resize(),window.addEventListener("resize",()=>this.resize());for(let t=0;t<5;t++){this.bacteria.push({x:Math.random()*this.width,y:Math.random()*this.height,radius:30+20*Math.random(),health:100,membrane:[],dying:!1,rotation:Math.random()*Math.PI*2,rotationSpeed:.01*(Math.random()-.5)});const a=this.bacteria[t];for(let t=0;t<32;t++){const i=t/32*Math.PI*2;a.membrane.push({angle:i,offset:0,targetOffset:0})}}for(let t=0;t<15;t++)this.peptides.push({x:Math.random()*this.width,y:Math.random()*this.height,vx:2*(Math.random()-.5),vy:2*(Math.random()-.5),size:4,attached:null,attachPoint:null,color:`hsla(0, 100%, ${50+20*Math.random()}%, 0.9)`})}resize(){const t=this.canvas.getBoundingClientRect();this.width=t.width,this.height=t.height,this.canvas.width=this.width,this.canvas.height=this.height}update(){for(this.frame++,this.peptides.forEach(t=>{if(t.attached){const a=t.attached;t.x=a.x+Math.cos(t.attachPoint+a.rotation)*(a.radius+5),t.y=a.y+Math.sin(t.attachPoint+a.rotation)*(a.radius+5),Math.random()<.1&&this.particles.push({x:t.x,y:t.y,vx:3*(Math.random()-.5),vy:3*(Math.random()-.5),life:1,color:"rgba(220, 38, 38, 0.6)"})}else t.x+=t.vx,t.y+=t.vy,(t.x<0||t.x>this.width)&&(t.vx*=-1),(t.y<0||t.y>this.height)&&(t.vy*=-1),this.bacteria.forEach(a=>{const i=t.x-a.x,h=t.y-a.y;if(Math.sqrt(i*i+h*h)<a.radius+10&&a.health>0){t.attached=a,t.attachPoint=Math.atan2(h,i);const e=Math.floor((t.attachPoint+Math.PI)/(2*Math.PI)*a.membrane.length);a.membrane[e].targetOffset=15;for(let t=-2;t<=2;t++){const i=(e+t+a.membrane.length)%a.membrane.length;a.membrane[i].targetOffset=10*(1-Math.abs(t)/3)}a.health-=.5}})}),this.bacteria.forEach(t=>{if(t.rotation+=t.rotationSpeed,t.membrane.forEach(t=>{t.offset+=.1*(t.targetOffset-t.offset),t.targetOffset*=.95}),t.health<=0&&!t.dying){t.dying=!0;for(let a=0;a<20;a++)this.particles.push({x:t.x,y:t.y,vx:5*(Math.random()-.5),vy:5*(Math.random()-.5),life:1,color:`rgba(220, 38, 38, ${.5*Math.random()+.3})`})}t.dying&&(t.radius*=.95)}),this.particles=this.particles.filter(t=>(t.x+=t.vx,t.y+=t.vy,t.vx*=.98,t.vy*=.98,t.life-=.02,t.life>0)),this.bacteria=this.bacteria.filter(t=>t.radius>5);this.bacteria.length<5;){const t={x:Math.random()*this.width,y:Math.random()*this.height,radius:30+20*Math.random(),health:100,membrane:[],dying:!1,rotation:Math.random()*Math.PI*2,rotationSpeed:.01*(Math.random()-.5)};for(let a=0;a<32;a++){const i=a/32*Math.PI*2;t.membrane.push({angle:i,offset:0,targetOffset:0})}this.bacteria.push(t)}}draw(){this.ctx.fillStyle="rgba(10, 10, 10, 0.1)",this.ctx.fillRect(0,0,this.width,this.height),this.bacteria.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.beginPath(),t.membrane.forEach((a,i)=>{const h=t.radius+a.offset,e=Math.cos(a.angle)*h,s=Math.sin(a.angle)*h;0===i?this.ctx.moveTo(e,s):this.ctx.lineTo(e,s)}),this.ctx.closePath();const a=this.ctx.createRadialGradient(0,0,0,0,0,t.radius);a.addColorStop(0,`rgba(30, 30, 30, ${t.health/100*.8})`),a.addColorStop(1,`rgba(50, 50, 50, ${t.health/100*.4})`),this.ctx.fillStyle=a,this.ctx.fill(),this.ctx.strokeStyle=`rgba(255, 255, 255, ${t.health/100*.1})`,this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.arc(0,0,.3*t.radius,0,2*Math.PI),this.ctx.fillStyle=`rgba(20, 20, 20, ${t.health/100*.6})`,this.ctx.fill(),this.ctx.restore()}),this.peptides.forEach(t=>{this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fillStyle=t.color,this.ctx.fill();const a=this.ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,3*t.size);a.addColorStop(0,"rgba(220, 38, 38, 0.3)"),a.addColorStop(1,"transparent"),this.ctx.fillStyle=a,this.ctx.fillRect(t.x-3*t.size,t.y-3*t.size,6*t.size,6*t.size)}),this.particles.forEach(t=>{this.ctx.beginPath(),this.ctx.arc(t.x,t.y,2,0,2*Math.PI),this.ctx.fillStyle=t.color,this.ctx.globalAlpha=t.life,this.ctx.fill(),this.ctx.globalAlpha=1})}animate(){this.update(),this.draw(),requestAnimationFrame(()=>this.animate())}}document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("amp-canvas");a&&new t(a)});
