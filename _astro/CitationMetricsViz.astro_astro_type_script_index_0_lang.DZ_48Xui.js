function t(){const t=document.getElementById("citation-chart");if(!t)return;const e=t.dataset.citationData;if(!e)return;const a=JSON.parse(e);t.innerHTML="";const n=20,s=80,r=50,i=60,o=t.clientWidth-i-s,d=400-n-r,l=d3.select("#citation-chart").append("svg").attr("width",o+i+s).attr("height",d+n+r),c=l.append("g").attr("transform",`translate(${i},${n})`),u=d3.scaleLinear().domain(d3.extent(a,t=>t.year)).range([0,o]),p=d3.scaleLinear().domain([0,d3.max(a,t=>Math.max(t.citations,t.hIndex))]).range([d,0]),y=d3.scaleLinear().domain([0,d3.max(a,t=>t.cumulative)]).range([d,0]);d3.line().x(t=>u(t.year)).y(t=>p(t.citations)).curve(d3.curveCardinal);const m=d3.line().x(t=>u(t.year)).y(t=>y(t.cumulative)).curve(d3.curveCardinal),h=d3.line().x(t=>u(t.year)).y(t=>p(t.hIndex)).curve(d3.curveCardinal),f=l.append("defs").append("linearGradient").attr("id","area-gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1",d).attr("x2",0).attr("y2",0);f.append("stop").attr("offset","0%").attr("stop-color","#DA291C").attr("stop-opacity",.1),f.append("stop").attr("offset","100%").attr("stop-color","#DA291C").attr("stop-opacity",.3);const x=d3.area().x(t=>u(t.year)).y0(d).y1(t=>p(t.citations)).curve(d3.curveCardinal);c.append("path").datum(a).attr("class","area").attr("d",x).style("fill","url(#area-gradient)").style("opacity",0).transition().duration(1500).style("opacity",1),c.append("g").attr("class","axis x-axis").attr("transform",`translate(0,${d})`).call(d3.axisBottom(u).tickFormat(d3.format("d"))),c.append("g").attr("class","axis y-axis-left").call(d3.axisLeft(p)),c.append("g").attr("class","axis y-axis-right").attr("transform",`translate(${o},0)`).call(d3.axisRight(y)),c.append("text").attr("class","axis-label").attr("transform","rotate(-90)").attr("y",0-i).attr("x",0-d/2).attr("dy","1em").style("text-anchor","middle").style("fill","#9CA3AF").text("Annual Citations / h-Index"),c.append("text").attr("class","axis-label").attr("transform","rotate(-90)").attr("y",o+s-10).attr("x",0-d/2).attr("dy","-1em").style("text-anchor","middle").style("fill","#9CA3AF").text("Cumulative Citations");const v=d3.select("body").append("div").attr("class","chart-tooltip").style("opacity",0);c.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",t=>u(t.year)-12).attr("width",24).attr("y",d).attr("height",0).style("fill","#DA291C").style("opacity",.8).on("mouseover",function(t,e){v.transition().duration(200).style("opacity",1),v.html(`\n          <div class="font-medium mb-2">${e.year} Citations</div>\n          <div class="text-sm space-y-1">\n            <div>Annual: <span class="font-medium">${e.citations}</span></div>\n            <div>Cumulative: <span class="font-medium">${e.cumulative}</span></div>\n            <div>h-Index: <span class="font-medium">${e.hIndex}</span></div>\n            <div>i10-Index: <span class="font-medium">${e.i10Index}</span></div>\n          </div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){v.transition().duration(200).style("opacity",0)}).transition().duration(1e3).delay((t,e)=>100*e).attr("y",t=>p(t.citations)).attr("height",t=>d-p(t.citations)),c.append("path").datum(a).attr("class","line cumulative-line").attr("d",m).style("stroke","#FFD93D").style("stroke-width",3).style("fill","none").style("stroke-dasharray","1000").style("stroke-dashoffset","1000").transition().duration(2e3).delay(500).style("stroke-dashoffset","0"),c.append("path").datum(a).attr("class","line h-index-line").attr("d",h).style("stroke","#DC2626").style("stroke-width",3).style("fill","none").style("stroke-dasharray","1000").style("stroke-dashoffset","1000").transition().duration(2e3).delay(1e3).style("stroke-dashoffset","0"),c.selectAll(".cumulative-dot").data(a).enter().append("circle").attr("class","dot cumulative-dot").attr("cx",t=>u(t.year)).attr("cy",t=>y(t.cumulative)).attr("r",0).style("fill","#FFD93D").style("stroke","#1F2937").style("stroke-width",2).on("mouseover",function(t,e){d3.select(this).attr("r",6),v.transition().duration(200).style("opacity",1),v.html(`\n          <div class="font-medium mb-2">${e.year} Cumulative</div>\n          <div class="text-sm">Total Citations: <span class="font-medium">${e.cumulative}</span></div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){d3.select(this).attr("r",4),v.transition().duration(200).style("opacity",0)}).transition().duration(500).delay((t,e)=>100*e+1500).attr("r",4),c.selectAll(".h-index-dot").data(a).enter().append("circle").attr("class","dot h-index-dot").attr("cx",t=>u(t.year)).attr("cy",t=>p(t.hIndex)).attr("r",0).style("fill","#DC2626").style("stroke","#1F2937").style("stroke-width",2).on("mouseover",function(t,e){d3.select(this).attr("r",6),v.transition().duration(200).style("opacity",1),v.html(`\n          <div class="font-medium mb-2">${e.year} h-Index</div>\n          <div class="text-sm">h-Index: <span class="font-medium">${e.hIndex}</span></div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){d3.select(this).attr("r",4),v.transition().duration(200).style("opacity",0)}).transition().duration(500).delay((t,e)=>100*e+2e3).attr("r",4)}function e(){document.querySelectorAll(".citation-counter").forEach(t=>{const e=parseInt(t.dataset.target||"0"),a=performance.now();requestAnimationFrame(function n(s){const r=s-a,i=Math.min(r/2e3,1),o=1-Math.pow(1-i,3),d=Math.floor(0+(e-0)*o);t.textContent=d+"+",i<1?requestAnimationFrame(n):t.textContent=e+"+"})})}function a(){const a=new IntersectionObserver(n=>{n.forEach(n=>{if(n.isIntersecting){n.target.querySelectorAll('[data-animate="progress"]').forEach(t=>{const e=t.dataset.width||t.style.width?.replace("%","")||"0";setTimeout(()=>{t.style.width=`${e}%`},300)});n.target.querySelectorAll('[data-animate="circle"]').forEach(t=>{setTimeout(()=>{t.style.strokeDashoffset="50px"},800)}),n.target.querySelector(".citation-counter")&&setTimeout(e,500),n.target.querySelector("#citation-chart")&&setTimeout(t,700),a.unobserve(n.target)}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"}),n=document.querySelector(".citation-metrics-viz");n&&a.observe(n)}function n(){if("undefined"==typeof d3){const t=document.createElement("script");t.src="https://d3js.org/d3.v7.min.js",t.onload=a,document.head.appendChild(t)}else a()}let s;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),window.addEventListener("resize",()=>{clearTimeout(s),s=setTimeout(()=>{const e=document.querySelector("#citation-chart svg");e&&(e.remove(),t())},250)});
