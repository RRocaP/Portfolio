function t(){const t=document.getElementById("force-network");if(!t)return;const e=t.dataset.networkData;if(!e)return;const n=JSON.parse(e);t.innerHTML="";const o=t.clientWidth,r=d3.select("#force-network").append("svg").attr("width",o).attr("height",400).call(d3.zoom().scaleExtent([.1,4]).on("zoom",function(t){i.attr("transform",t.transform)})),i=r.append("g"),a=d3.forceSimulation(n.nodes).force("link",d3.forceLink(n.edges).id(t=>t.id).distance(t=>100+50*(1-t.strength))).force("charge",d3.forceManyBody().strength(t=>-300-10*t.size)).force("center",d3.forceCenter(o/2,200)).force("collision",d3.forceCollide().radius(t=>t.size+5)),s=r.append("defs");["strong","moderate","emerging"].forEach(t=>{const e=s.append("linearGradient").attr("id",`link-gradient-${t}`),n={strong:["#10B981","#059669"],moderate:["#3B82F6","#2563EB"],emerging:["#8B5CF6","#7C3AED"]};e.append("stop").attr("offset","0%").attr("stop-color",n[t][0]),e.append("stop").attr("offset","100%").attr("stop-color",n[t][1])});const c=d3.select("body").append("div").attr("class","network-tooltip").style("opacity",0),d=i.append("g").selectAll(".network-link").data(n.edges).enter().append("line").attr("class","network-link").attr("stroke",t=>`url(#link-gradient-${t.type})`).attr("stroke-width",t=>2+4*t.strength).attr("opacity",.7).on("mouseover",function(t,e){d3.select(this).attr("opacity",1),c.transition().duration(200).style("opacity",1),c.html(`\n          <div class="font-medium mb-2">Collaboration</div>\n          <div class="text-sm space-y-1">\n            <div>Strength: <span class="font-medium">${Math.round(100*e.strength)}%</span></div>\n            <div>Publications: <span class="font-medium">${e.publications}</span></div>\n            <div>Type: <span class="font-medium capitalize">${e.type}</span></div>\n          </div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){d3.select(this).attr("opacity",.7),c.transition().duration(200).style("opacity",0)}),l=i.append("g").selectAll(".network-node").data(n.nodes).enter().append("g").attr("class","network-node").call(d3.drag().on("start",function(t,e){t.active||a.alphaTarget(.3).restart();e.fx=e.x,e.fy=e.y}).on("drag",function(t,e){e.fx=t.x,e.fy=t.y}).on("end",function(t,e){t.active||a.alphaTarget(0);e.fx=null,e.fy=null}));l.append("circle").attr("r",t=>t.size).attr("fill",t=>t.color).attr("stroke","#1F2937").attr("stroke-width",3).on("mouseover",function(t,e){c.transition().duration(200).style("opacity",1),c.html(`\n          <div class="font-medium mb-2">${e.name}</div>\n          <div class="text-sm space-y-1">\n            <div>Type: <span class="font-medium capitalize">${e.type}</span></div>\n            <div>Institution: <span class="font-medium">${e.institution}</span></div>\n            <div>Country: <span class="font-medium">${e.country}</span></div>\n            <div>Publications: <span class="font-medium">${e.publications}</span></div>\n            <div>Strength: <span class="font-medium">${Math.round(100*e.strength)}%</span></div>\n          </div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){c.transition().duration(200).style("opacity",0)}),l.append("text").text(t=>t.name.split(" ")[0]).attr("x",0).attr("y",t=>t.size+15).attr("text-anchor","middle").attr("fill","#D1D5DB").attr("font-size","12px").attr("font-weight","500"),a.on("tick",()=>{d.attr("x1",t=>t.source.x).attr("y1",t=>t.source.y).attr("x2",t=>t.target.x).attr("y2",t=>t.target.y),l.attr("transform",t=>`translate(${t.x},${t.y})`)});document.querySelectorAll(".network-control-btn").forEach(t=>{t.addEventListener("click",function(){const t=this.dataset.action,e=d3.zoom();switch(t){case"zoom-in":r.transition().call(e.scaleBy,1.5);break;case"zoom-out":r.transition().call(e.scaleBy,1/1.5);break;case"reset":r.transition().call(e.transform,d3.zoomIdentity),a.alpha(1).restart()}})})}function e(){const t=document.getElementById("world-map");if(!t)return;const e=t.dataset.geoData;if(!e)return;const n=JSON.parse(e);t.innerHTML="";const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("viewBox","0 0 800 400");const r=document.createElementNS("http://www.w3.org/2000/svg","rect");r.setAttribute("width","800"),r.setAttribute("height","400"),r.setAttribute("fill","#1F2937"),r.setAttribute("rx","8"),o.appendChild(r),n.forEach((t,e)=>{if(t.lat&&t.lng){const n=(t.lng+180)/360*800,r=(90-t.lat)/180*400,i=document.createElementNS("http://www.w3.org/2000/svg","circle");if(i.setAttribute("cx",n),i.setAttribute("cy",r),i.setAttribute("r",t.size/2),i.setAttribute("fill",t.color),i.setAttribute("stroke","#1F2937"),i.setAttribute("stroke-width","2"),i.setAttribute("opacity","0"),i.style.transition=`opacity 0.5s ease ${.2*e}s`,"primary"===t.type){const e=document.createElementNS("http://www.w3.org/2000/svg","circle");e.setAttribute("cx",n),e.setAttribute("cy",r),e.setAttribute("r",t.size/2),e.setAttribute("fill","none"),e.setAttribute("stroke",t.color),e.setAttribute("stroke-width","2"),e.setAttribute("opacity","0"),e.style.animation="pulse 2s infinite",o.appendChild(e)}o.appendChild(i);const a=document.createElementNS("http://www.w3.org/2000/svg","text");a.setAttribute("x",n),a.setAttribute("y",r-t.size/2-5),a.setAttribute("text-anchor","middle"),a.setAttribute("fill","#D1D5DB"),a.setAttribute("font-size","10"),a.setAttribute("opacity","0"),a.textContent=t.country,a.style.transition=`opacity 0.5s ease ${.2*e+.5}s`,o.appendChild(a)}}),t.appendChild(o),setTimeout(()=>{o.querySelectorAll("circle, text").forEach(t=>{t.style.opacity="1"})},500)}function n(){const n=new IntersectionObserver(o=>{o.forEach(o=>{if(o.isIntersecting){o.target.querySelectorAll('[data-animate="progress"]').forEach(t=>{const e=t.dataset.width||t.style.width?.replace("%","")||"0";setTimeout(()=>{t.style.width=`${e}%`},300)});o.target.querySelectorAll('[data-animate="circle"]').forEach(t=>{setTimeout(()=>{t.style.strokeDashoffset="50px"},800)}),o.target.querySelector("#force-network")&&setTimeout(()=>{"undefined"!=typeof d3&&t()},500),o.target.querySelector("#world-map")&&setTimeout(e,700),n.unobserve(o.target)}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"}),o=document.querySelector(".enhanced-collaboration-network");o&&n.observe(o)}function o(){if("undefined"==typeof d3){const t=document.createElement("script");t.src="https://d3js.org/d3.v7.min.js",t.onload=n,document.head.appendChild(t)}else n()}let r;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o(),window.addEventListener("resize",()=>{clearTimeout(r),r=setTimeout(()=>{const e=document.querySelector("#force-network svg");e&&(e.remove(),t())},250)});
