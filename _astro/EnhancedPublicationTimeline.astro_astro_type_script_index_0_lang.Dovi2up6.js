function t(){const t=document.getElementById("timeline-chart");if(!t)return;const e=t.dataset.timelineData;if(!e)return;const a=JSON.parse(e);t.innerHTML="";const n=20,s=60,i=50,r=60,o=t.clientWidth-r-s,l=400-n-i,d=d3.select("#timeline-chart").append("svg").attr("width",o+r+s).attr("height",l+n+i).append("g").attr("transform",`translate(${r},${n})`),c=d3.scaleLinear().domain(d3.extent(a,t=>t.year)).range([0,o]),u=d3.scaleLinear().domain([0,d3.max(a,t=>Math.max(t.count,t.hIndex))]).range([l,0]),y=d3.scaleLinear().domain([0,d3.max(a,t=>t.cumulativeCitations)]).range([l,0]);d3.line().x(t=>c(t.year)).y(t=>u(t.count)).curve(d3.curveCardinal);const m=d3.line().x(t=>c(t.year)).y(t=>u(t.hIndex)).curve(d3.curveCardinal),p=d3.line().x(t=>c(t.year)).y(t=>y(t.cumulativeCitations)).curve(d3.curveCardinal);d.append("g").attr("class","axis x-axis").attr("transform",`translate(0,${l})`).call(d3.axisBottom(c).tickFormat(d3.format("d"))),d.append("g").attr("class","axis y-axis-left").call(d3.axisLeft(u)),d.append("g").attr("class","axis y-axis-right").attr("transform",`translate(${o},0)`).call(d3.axisRight(y)),d.append("text").attr("class","axis-label").attr("transform","rotate(-90)").attr("y",0-r).attr("x",0-l/2).attr("dy","1em").style("text-anchor","middle").style("fill","#9CA3AF").text("Publications / h-Index"),d.append("text").attr("class","axis-label").attr("transform","rotate(-90)").attr("y",o+s).attr("x",0-l/2).attr("dy","-1em").style("text-anchor","middle").style("fill","#9CA3AF").text("Cumulative Citations");const h=d3.select("body").append("div").attr("class","chart-tooltip").style("opacity",0);d.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("x",t=>c(t.year)-8).attr("width",16).attr("y",l).attr("height",0).style("fill","#DA291C").style("opacity",.7).on("mouseover",function(t,e){h.transition().duration(200).style("opacity",1),h.html(`\n          <div class="font-medium mb-2">${e.year}</div>\n          <div class="text-sm space-y-1">\n            <div>Publications: <span class="font-medium">${e.count}</span></div>\n            <div>Avg Impact Factor: <span class="font-medium">${e.averageIF}</span></div>\n            <div>h-Index: <span class="font-medium">${e.hIndex}</span></div>\n            <div>Total Citations: <span class="font-medium">${e.cumulativeCitations}</span></div>\n          </div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){h.transition().duration(200).style("opacity",0)}).transition().duration(1e3).delay((t,e)=>100*e).attr("y",t=>u(t.count)).attr("height",t=>l-u(t.count)),d.append("path").datum(a).attr("class","line h-index-line").attr("d",m).style("stroke","#DC2626").style("stroke-width",3).style("fill","none").style("stroke-dasharray","1000").style("stroke-dashoffset","1000").transition().duration(2e3).style("stroke-dashoffset","0"),d.append("path").datum(a).attr("class","line citation-line").attr("d",p).style("stroke","#FFD93D").style("stroke-width",3).style("fill","none").style("stroke-dasharray","1000").style("stroke-dashoffset","1000").transition().duration(2e3).delay(500).style("stroke-dashoffset","0"),d.selectAll(".h-index-dot").data(a).enter().append("circle").attr("class","dot h-index-dot").attr("cx",t=>c(t.year)).attr("cy",t=>u(t.hIndex)).attr("r",0).style("fill","#DC2626").style("stroke","#1F2937").style("stroke-width",2).on("mouseover",function(t,e){h.transition().duration(200).style("opacity",1),h.html(`\n          <div class="font-medium mb-2">${e.year} h-Index</div>\n          <div class="text-sm">h-Index: <span class="font-medium">${e.hIndex}</span></div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){h.transition().duration(200).style("opacity",0)}).transition().duration(500).delay((t,e)=>100*e+1500).attr("r",4),d.selectAll(".citation-dot").data(a).enter().append("circle").attr("class","dot citation-dot").attr("cx",t=>c(t.year)).attr("cy",t=>y(t.cumulativeCitations)).attr("r",0).style("fill","#FFD93D").style("stroke","#1F2937").style("stroke-width",2).on("mouseover",function(t,e){h.transition().duration(200).style("opacity",1),h.html(`\n          <div class="font-medium mb-2">${e.year} Citations</div>\n          <div class="text-sm">Total: <span class="font-medium">${e.cumulativeCitations}</span></div>\n        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")}).on("mouseout",function(){h.transition().duration(200).style("opacity",0)}).transition().duration(500).delay((t,e)=>100*e+2e3).attr("r",4)}function e(){const e=new IntersectionObserver(a=>{a.forEach(a=>{if(a.isIntersecting){a.target.querySelectorAll('[data-animate="progress"]').forEach(t=>{const e=t.dataset.width||"0";setTimeout(()=>{t.style.width=`${e}%`},300)});a.target.querySelectorAll('[data-animate="circle"]').forEach(t=>{setTimeout(()=>{t.style.strokeDashoffset="50px"},800)}),a.target.querySelector("#timeline-chart")&&setTimeout(t,500),e.unobserve(a.target)}})},{threshold:.1,rootMargin:"0px 0px -50px 0px"}),a=document.querySelector(".enhanced-publication-timeline");a&&e.observe(a)}function a(){if("undefined"==typeof d3){const t=document.createElement("script");t.src="https://d3js.org/d3.v7.min.js",t.onload=e,document.head.appendChild(t)}else e()}let n;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a(),window.addEventListener("resize",()=>{clearTimeout(n),n=setTimeout(()=>{const e=document.querySelector("#timeline-chart svg");e&&(e.remove(),t())},250)});
